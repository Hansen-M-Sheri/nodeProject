<!DOCTYPE html>
<html>
<head>
	<title>Notification</title>
		<meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
</head>
<body>
	<div class="jumbotron bg-info" id="banner">
		<h1>Create and Run Notifications</h1>
		<h4>Originally my plan was to set a notification which would select a topic and frequency that a user would have a scripture texted to them from that topic.  Since the free version of Heroku will not allow for cronjobs which would be required for this, I am simulating th ability for notifications in the following way. This page will show a button for every topic you have entered.  If you click that button, a scripture from that topic will be sent one time to your phone by SMS thru twilio</h4>
	</div>
<div class="container">
		<!-- <form class="form-group col-md-4 col-md-offset-4" method="POST" > -->
			<center><h2>Send a Scripture by Topic to your phone</h2></center><br>
			<div id="buttons">
			</div>
		<!-- </form>	 -->
	</div>

	<script>
		window.addEventListener('load', getTopics);
		
		function getTopics(){
			//check for session
					$.ajax({
			type: "GET",
			url: "/topics",
			success: function(result){
				var topics = JSON.parse(result);
				// console.log("topics: "+topics[0] + " " + topics[1]);
				displayDropDownTopics(topics);
			}

		})
		}

		function getTopicID(name){
			//check for session
					$.ajax({
			type: "GET",
			url: "/getTopicIDByName?name="+name,
			success: function(result){
				var id = JSON.parse(result);
				// console.log("topics: "+topics[0] + " " + topics[1]);
				return(result);
				}

		})
		}

		//method to send notification by text of random scripture
		function notify(topicName){
			//get topicID
			var id = getTopicID(topicName);
			//get count of scriptures
			var count = getScriptureCountByTopic(id);
			this.innerHTML = count;
			this.className += ' dynamic-success';
		}

		//display buttons that are options to select for sending text
		function displayDropDownTopics(topics){
			var buttons = document.getElementById('buttons');
			
			for(var i = 0; i < topics.length; i++){
				var button = document.createElement('button');
				button.className="btn btn-primary";
				button.id=topics[i].name; 
				button.innerHTML = topics[i].name;
				buttons.appendChild(button);
				// console.log(topics[i].id);
				button.onclick = notify(topics[i].name);
			}
		}

		function getScriptureCountByTopic(topicID){
			$.ajax({
			type: "GET",
			url: "/getNumScripturesByTopicID?id="+topicID,
			success: function(result){
				var count = JSON.parse(result);
				return(count);
			}

		})
		}
		function getRandomInt(min, max) {
		  min = Math.ceil(min);
		  max = Math.floor(max);
		  return Math.floor(Math.random() * (max - min)) + min; //The maximum is exclusive and the minimum is inclusive
		}
	</script>
</body>
</html>